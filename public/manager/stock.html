<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kulfi ERP | Stock Management</title>
    <link rel="stylesheet" href="../css/manager/stock.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>

  <body>
     <div id="auth-loader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0f2f5; z-index: 99999; display: flex; justify-content: center; align-items: center; flex-direction: column;">
        <div class="spinner" style="width: 50px; height: 50px; border: 4px solid #ddd; border-top: 4px solid #ff5722; border-radius: 50%; animation: spin 0.8s linear infinite;"></div>
        <h4 style="margin-top: 15px; font-family: sans-serif; color: #555;">Loading Stock Data...</h4>
    </div>
    <style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>


    <header class="topbar">
      <div class="header-left">
        <button id="menu-btn" class="menu-toggle">
          <i data-lucide="menu"></i>
        </button>
        <h2>Kulfi ERP</h2>
      </div>
      <div class="user-info">
        <span class="role-badge">Manager</span>
        <div class="profile-icon">
          <img
            src="https://ui-avatars.com/api/?name=Manager+User&background=0D8ABC&color=fff"
            alt="User"
          />
        </div>
      </div>
    </header>

    <div class="layout">
      <aside class="sidebar" id="sidebar">
        <button id="close-sidebar" class="close-btn">&times;</button>
        <div class="sidebar-header">
          <h3>Menu</h3>
        </div>
        <nav class="nav-links">
          <a href="./dashboard.html" ><i data-lucide="layout-dashboard"></i> Dashboard</a>
          <a href="./stock.html" class="active"><i data-lucide="package"></i> Stock</a>
          <a href="./sales.html"><i data-lucide="bar-chart-3"></i> Sales/Purchase</a>
          <a href="./credit.html"><i data-lucide="credit-card"></i> Credit</a>
          <a href="./shops.html"><i data-lucide="store"></i> Shops</a>
          <a href="./expense.html"><i data-lucide="banknote"></i> Expenses</a>
          <a href="./staff.html"><i data-lucide="users"></i> Staff</a>
          <a href="#" id="logout-btn" class="logout">
              <i data-lucide="log-out"></i> <span>Logout</span>
          </a>        
        </nav>
      </aside>

      <div class="overlay" id="overlay"></div>

      <main class="content">
        <div class="page-header">
          <h3>Stock Management</h3>
          <div class="header-actions">
            <button class="btn btn-assign" id="assign-stock-btn">
              <i data-lucide="arrow-right-circle"></i> Assign to Boy
            </button>
            <button class="btn btn-return" id="return-stock-btn">
              <i data-lucide="arrow-left-circle"></i> Return Stock
            </button>
            <button class="btn btn-damage" id="damage-stock-btn">
              <i data-lucide="alert-triangle"></i> Damaged Entry
            </button>
          </div>
        </div>

        <div class="stats-row">
          <div class="mini-card">
            <span>Godown Stock</span>
            <h4>12 Items</h4>
          </div>

          <div class="mini-card info">
            <span id="boy-stock-title">Stock with Boys</span>
            <h4 id="boy-stock-count">0 Items</h4>
          </div>

          <div class="mini-card danger">
            <span>Out of Stock</span>
            <h4>1 Item</h4>
          </div>

          <div class="mini-card danger" style="position: relative">
            <span>Total Damaged</span>
            <h4 id="total-damaged-count">0 Items</h4>
            <button
              id="reset-damage-btn"
              style="
                position: absolute;
                top: 15px;
                right: 15px;
                background: none;
                border: none;
                cursor: pointer;
                padding: 0;
              "
            >
              <i
                data-lucide="rotate-ccw"
                style="width: 16px; height: 16px; color: #e74c3c; opacity: 0.7"
              ></i>
            </button>
          </div>
        </div>

        <div class="filter-bar">
          <div class="search-box">
            <i data-lucide="search"></i>
            <input
              type="text"
              id="stock-search"
              placeholder="Search product name..."
            />
          </div>

          <select class="filter-select">
            <option value="all">All Categories</option>
            <option value="kulfi">Kulfi</option>
            <option value="ice-cream">Ice Cream</option>
            <option value="shakes">Shakes</option>
          </select>

          <select
            class="filter-select"
            id="boy-stock-filter"
            style="border-color: var(--info)"
          >
            <option value="all">All Boys Stock</option>
            <option value="Ramesh Kumar">Ramesh Kumar</option>
            <option value="Suresh Singh">Suresh Singh</option>
            <option value="Rahul Verma">Rahul Verma</option>
          </select>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Category</th>
                <th>Price (â‚¹)</th>
                <th>Stock Qty</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="stock-table-body">
              <tr>
                <td colspan="6" style="text-align: center">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </main>
    </div>

    <div id="assign-modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Assign Stock to Delivery Boy</h3>
          <button class="close-modal" data-target="assign-modal">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="assign-form">
            <div class="form-group">
              <label>Select Delivery Boy</label>
              <select id="assign-boy-select" required>
                <option value="">-- Select --</option>
                <option value="Ramesh Kumar">Ramesh Kumar</option>
                <option value="Suresh Singh">Suresh Singh</option>
                <option value="Rahul Verma">Rahul Verma</option>
              </select>
            </div>
            <div class="form-group">
              <label>Select Product</label>
              <select required>
                <option>Kesar Pista Kulfi</option>
                <option>Malai Kulfi</option>
                <option>Mango Dolly</option>
              </select>
            </div>
            <div class="form-group">
              <label>Quantity to Assign</label>
              <input
                type="number"
                id="assign-qty"
                placeholder="Enter Qty"
                required
              />
            </div>
            <button
              type="submit"
              class="save-btn"
              style="background: var(--info)"
            >
              Assign Stock
            </button>
          </form>
        </div>
      </div>
    </div>

    <div id="return-modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Return Stock from Delivery Boy</h3>
          <button class="close-modal" data-target="return-modal">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="return-form">
            <div class="form-group">
              <label>Select Delivery Boy</label>
              <select id="return-boy-select" required>
                <option value="">-- Select --</option>
                <option value="Ramesh Kumar">Ramesh Kumar</option>
                <option value="Suresh Singh">Suresh Singh</option>
                <option value="Rahul Verma">Rahul Verma</option>
              </select>
            </div>
            <div class="form-group">
              <label>Select Product</label>
              <select required>
                <option>Kesar Pista Kulfi</option>
                <option>Malai Kulfi</option>
              </select>
            </div>
            <div class="form-group">
              <label>Quantity Returned</label>
              <input
                type="number"
                id="return-qty"
                placeholder="Enter Qty"
                required
              />
            </div>
            <p style="font-size: 12px; color: #e74c3c; margin-bottom: 10px">
              * This will add stock back to Godown.
            </p>
            <button
              type="submit"
              class="save-btn"
              style="background: var(--warning)"
            >
              Process Return
            </button>
          </form>
        </div>
      </div>
    </div>

    <div id="damage-modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Report Damaged Stock</h3>
          <button class="close-modal" data-target="damage-modal">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="damage-form">
            <div class="form-group">
              <label>Select Product</label>
              <select required>
                <option>Kesar Pista Kulfi</option>
                <option>Malai Kulfi</option>
                <option>Mango Dolly</option>
              </select>
            </div>
            <div class="form-group">
              <label>Quantity Damaged</label>
              <input
                type="number"
                id="damage-qty"
                placeholder="Enter Qty"
                required
              />
            </div>
            <div class="form-group">
              <label>Reason / Note</label>
              <input
                type="text"
                placeholder="E.g. Melted, Broken Stick, Expired"
              />
            </div>
            <p style="font-size: 12px; color: #e74c3c; margin-bottom: 10px">
              * This will remove stock permanently (Loss).
            </p>
            <button
              type="submit"
              class="save-btn"
              style="background: var(--danger)"
            >
              Report Damage
            </button>
          </form>
        </div>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <script src="../js/firebase-config.js"></script>

    <script src="../js/manager/backend/authGuard.js"></script>
    <script src="../js/manager/stock/backend/stockService.js"></script>
    <script src="../js/manager/stock/ui/stockUI.js"></script>
    <script src="../js/manager/stock/backend/stockController.js"></script>
    <script src="../js/manager/stock/stockMain.js"></script>

  </body>
</html>
